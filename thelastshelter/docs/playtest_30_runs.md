# 30 局抽样试玩标准（Balance & Frequency 验收）

用于快速判断牌面频率「太稀 / 太密 / 太早 / 太晚」。只改 `functions/game/balanceConfig.ts` 的窗口/上限/保底即可调频，不改业务逻辑。

## 执行方法

1. **先用 high profile 跑 10 局**：验证牌面逻辑不破（压力测试）。  
   - 请求头加 `X-Balance-Profile: high` 或 query `?balance=high`。
2. **再用 prod 跑 30 局**：按下表看命中率。
3. 若「太密/太稀」：只改 `balanceConfig.ts` 的 `rareLoot.windows`、`gamble.window`、`maxPerRun` 等，不改 `playabilityCards.ts` 逻辑。

## 30 局判定阈值（推荐）

| 指标 | 标准 | 说明 |
|------|------|------|
| **稀有机会** | 每局 ≥1 次（总体 ≥25/30） | 允许早撤/早死导致单局缺失，但 30 局里至少 25 局出现过。 |
| **孤注一掷** | 出现率 40%–70%（约 12–21/30），且每局最多 1 次 | 太少说明窗口太窄或条件过严，太多说明太宽。 |
| **条件撤离** | 当背包有保险丝且出现撤离窗口时，命中率 90%+（取样 10 次至少 9 次出现） | 即「有保险丝 + 撤离窗口」的局里，至少 9 成能看到《条件撤离》选项。 |
| **撤离压力提示** | 撤离出现后，2 步内至少出现一次提示（取样 20 次至少 18 次） | 即 EXTRACT_PRESSURE 或 scene 中「撤离/越拖」类提示，在撤离窗口出现后 2 步内出现。 |
| **fallback** | < 5%（30 局内 ≤1–2 次） | 即 DeepSeek 超时/解析失败/校验失败导致的兜底响应。 |

## 快速统计来源

- 前端 Debug 面板「快速统计（最近 20 条）」：来自 `TurnTrace` 环缓冲，按 `cards` 与 `isFallback` 汇总。
- 「复制统计」：复制「版本 + 稀有机会/孤注一掷/条件撤离/撤离压力/fallback/总回合数」，便于贴给团队或存档。

## 调频只改配置

- **稀有机会太稀**：扩大 `rareLoot.windows`（如 prod 的 `[[3,5],[8,10]]` 改为 `[[2,6],[7,11]]`）或提高 `maxPerRun`。
- **稀有机会太密**：收窄窗口或降低 `maxPerRun`（如 2→1）。
- **孤注一掷太稀/太密**：改 `gamble.window`（如 `[6,11]` → `[5,12]` 或 `[8,10]`）。
- **撤离压力提示不够**：确保 `extractWindow.softDeadlineSteps: 2`，且服务端在撤离窗口出现时发 EXTRACT_PRESSURE（prod 下 `showOncePerRun: true` 即首次出现时 1 次）。
